<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Leitch">
<meta name="dcterms.date" content="2023-06-01">

<title>Pumped Hydro and batteries – ITK Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../ITK_logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d166b450ba5a8e9f7a0ab969bf6592c1.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-485e50d28d76f17c9a54ab231639fb97.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-f9f99e9f92a7e94224d7c17645ae6320.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Pumped Hydro and batteries – ITK Research">
<meta property="og:description" content="Electricity markets analysis">
<meta property="og:image" content="https://itk.quarto.pub/itk_articles/posts/PH_v_batteries/media/media/image1.png">
<meta property="og:site_name" content="ITK Research">
<meta property="og:image:height" content="457">
<meta property="og:image:width" content="845">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../ITK_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ITK Research</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../forecast.html"> 
<span class="menu-text">AEMO demand fcst</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../nem-dash.html"> 
<span class="menu-text">NEM-dash</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../IEA.html"> 
<span class="menu-text">IEA-electricity</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="../../posts.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../mailchimp.html"> 
<span class="menu-text">Signup</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Pumped Hydro and batteries</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">analysis</div>
                <div class="quarto-category">qld</div>
                <div class="quarto-category">storage</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>David Leitch </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 1, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#gw-dominates-2-gw" id="toc-gw-dominates-2-gw" class="nav-link active" data-scroll-target="#gw-dominates-2-gw">6 GW dominates 2 GW</a></li>
  <li><a href="#confirming-the-obvious-with-a-model" id="toc-confirming-the-obvious-with-a-model" class="nav-link" data-scroll-target="#confirming-the-obvious-with-a-model">Confirming the obvious with a model</a></li>
  <li><a href="#in-fy45-in-qld-february-is-the-worst-month" id="toc-in-fy45-in-qld-february-is-the-worst-month" class="nav-link" data-scroll-target="#in-fy45-in-qld-february-is-the-worst-month">In FY45 in QLD February is the worst month</a></li>
  <li><a href="#in-table-form-a-subset-of-the-numbers-shows" id="toc-in-table-form-a-subset-of-the-numbers-shows" class="nav-link" data-scroll-target="#in-table-form-a-subset-of-the-numbers-shows">In table form a subset of the numbers shows:</a></li>
  <li><a href="#economics" id="toc-economics" class="nav-link" data-scroll-target="#economics">Economics</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>In this note I purport to show that a 6 GW/8 hour battery is a superior choice to a 2 GW/24 hour pumped hydro station albeit its life is shorter and its cost is a bit higher. The BESS can provide much more firming than the pumped hydro system, can provide all the system services QLD will need and can likely support the transmission network rather than requiring $ bns of additional transmission. Of course the transmission may be needed anyway.</p>
<section id="gw-dominates-2-gw" class="level1">
<h1>6 GW dominates 2 GW</h1>
<p>The recently released information that QLD’s Borumba pumped hydro station will cost $14 bn for 2 GW of 24 hour storage = 48 GWh is in my opinion a good reason for the QLD Govt to re examine its options.</p>
<p>Batteries have a higher capital cost than pumped hydro although the difference based on Borumba is so much less than we are used to thinking. (see table at end of document)</p>
<p>Also Pumped Hydro once built could be expected to last for 50 years or more. A battery or as its called a BESS [Battery energy storage system] typically has a life of 20 years based on a rated number of cycles per year.</p>
<p>That’s the end of the advantages of pumped hydro. The disadvantages include massive social license issues, long build times, a very low learning rate, cost blow out exposure, limited ability (compared to BESS) to provide system services (virtual inertia, black start) and typically lots of transmission.</p>
<p>However the epiphany I had was that Pumped hydro maximum power and configuration flexibility is non existent. If you build a 2 GW /24 hour pumped hydro station at best you can provide 2 GW of power for 24 hours.</p>
<p>By contrast a BESS with the same storage capacity as Borumba can be configured however you like. Specifically you could configure your 48 GWh as 2 GW by 24 hours , 4 GW of 12 hours, 8 GW of 6 hours and so on.</p>
<p>Lets say your BESS was configured as 6 GW of 8 hour storage. That’s the same energy (48 GWh) as Borumba. You can run that as 6 GW operating as 8 hours or you can run 2 GW for 8 hours then the next 2 GW then the final 2 GW. You get 2 GW /24 hour just the same as the pumped hydro. But now you can take advantage of all the opportunities when you need more than 2 GW but only for a few hours.</p>
</section>
<section id="confirming-the-obvious-with-a-model" class="level1">
<h1>Confirming the obvious with a model</h1>
<p>Due to previous work it was easy enough to setup in my very humble ITK model (not to be compared with space rockets like PLEXOS) a 2 GW 24 hour pumped hydro asset and also for comparison a 6 GW 8 hour BESS.</p>
<p>The way these models work is purely mechanical I start the storage asset at 80% full. For every half hour if demand exceeds VRE then the storage asset trys to fill the gap subject to its maximum power and also how much energy it has. If it doesn’t have enough energy then it supplys until it is empty. The reverse is true if VRE supply exceeds demand. In that case the storage asset trys to store the excess subject to its power and its state of charge. Any excess supply left over is spilled and is recorded as a negative net firming demand. Results show that the assets are regularly either empty or full because the QLD needs more than 48 GWh of storage and more than 6 GW of firming power once it gets to 100% VRE supply around 2040 on the ISP view.</p>
<p>In this case both assets were assumed to have 75% round trip efficiency (even though BESS can achieve 85%)</p>
<p>In this exercise I only compared their peforrmance for the hypothetical FY 2045 in QLD. But the results could very easily be extended. Frankly I just got lazy. Note my model uses ISP data, if QLD builds its VRE at the Energy and Jobs plan forecast pace it will get to 100% VRE around 2035. So while this note focusses on a notional FY45 it might as well by FY35 on the QLD Govt timetable.</p>
<p>First of all I show the average day in FY45 for QLD. The source data is basically from that provided by AEMO as part of the ISP 2022 documentation. All calculations and adjustments are of course my own.</p>
<p><a href="media/media/image1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="media/media/image1.png" style="width:5.86111in;height:3.16667in"></a></p>
<p>Figure 1 QLD FY45 (100% renwable) average day. Source: ITK</p>
<p>As stated in the prior note by 2045 some hydrogen demand is included and AEMO has carefully estimated electrification and EVs and changed the demand shape accordingly.</p>
<p>Its important to understand that storage has to cope with wind and solar droughts as well as copinng with the average day. Nevertheless its interesting to look at the most common situation.</p>
<p>Basically I compared the performance of Borumba with a 6 GW/8 hour BESS by <strong>looking at the residual need for firming</strong> after operating whichever storage asset I am modelling. Neither I nor anyone else is suggesting that Borumba alone can provide all the firming needed in a decarbonised QLD electricity supply.</p>
<p>The following chart shows the residual demand for firming for both systems using median data. Medians don’t capture extremes (edge cases) but they still provide a useful view in my opinion.</p>
<p><a href="media/media/image2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="media/media/image2.png" style="width:5.88889in;height:3.16667in"></a></p>
<p>Figure 2 Median day FY45 QLD firming net of either Borumba or a 6GW BESS. Source:ITK</p>
<p>On this measure we can see that the 6 GW BESS comprehensively outperforms the 2 GW pumped hydro asset. Using medians. 6 GW of 8 hour storage means that no firming demand is needed in the evenings but using Borumba would still require another 3 GW of firming power in the evening.</p>
<p>The BESS doesn’t perform quite as well in the morning, probably because its empty on lots of days but even so because it can recharge at 6GW instead of 2 GW it still does a better job than Borumba.</p>
<p>Consumers big and small don’t care about spilled energy, they only care about having enough power to run as they want to. So for this next graph I only show results for when demand exceeded VRE. In this modelled year (FY45) that happened on 9867/17520 = 56% of half hours. The average demand over those half hours was 11.6 GW and average VRE production 7.4 GW.</p>
<p>The following chart shows a rolling 30 day sum (in GWh) of positive firming demand after operating our storage assets. That is we ran the system with Borumba and then ran the system with the BESS. They assets operated over all half hours (ie recharged when supply exceeded demand) but the graph just shows how they performed when demand exceeds VRE supply.</p>
<p>Again the result clearly favours the BESS. Typically the system with the 6 GW BESS requires about 0.8 TWh less additional firming per month relative to the system with the 2 GW Borumba pumped hydro asset. “net” means the difference between the Borumba and the BES results</p>
<p><a href="media/media/image3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="media/media/image3.png" style="width:5.68056in;height:3.05556in"></a></p>
<p>Figure 3 QLD FY45 net firming energy rolling 30 days Borumba v BESS. Source: ITK</p>
</section>
<section id="in-fy45-in-qld-february-is-the-worst-month" class="level1">
<h1>In FY45 in QLD February is the worst month</h1>
<p>All of this analysis considers QLD as an island. That is a bad way to do things. NSW and QLD have very complementary wind systems and strong inter connects between the two States will greatly benefit both. In another note I’ll show that result again. Nevertheless considering QLD as an island the greatest need for firming comes in February.</p>
<p><a href="media/media/image4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="media/media/image4.png" style="width:5.75in;height:3.27778in"></a></p>
<p>Figure 4 QLD FY45 rolling 30 day Demand, VRE. Source: ITK</p>
<p>So looking at February 2045 half hour by half hour the following figure shows the state of charge, in MWh, (maximum is 48,000 when the storage is full for both systems). The chart shows that both systems are regularly at zero state of charge but that the extra power of the battery means it can recharge much more easily than the lower power Borumba asset and this is what enables it to easily outperform Borumba.</p>
<p><a href="media/media/image5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="media/media/image5.png" style="width:5.73611in;height:3.38889in"></a></p>
<p>Figure 5 QLD FY45 SOC Borumba compared to BESS. Source: ITK</p>
<p>And to further illustrate, the following chart shows model output for Feb 21, 2045.</p>
<p>The day starts with the BESS or Borumba empty due to having been run flat the evening before. Neither asset was able to do anything until solar output went up. After that, because there was enough Sun the BESS was able to achieve a much higher state of charge [SOC] and therefore could contribute more to evening demand. Note that the SOC lines are in MWh but other lines are MW. (footnote I can’t find a way to make the chart simpler)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="media/media/image6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="A picture containing text, screenshot, diagram, plot Description automatically generated"><img src="media/media/image6.png" style="width:5.80556in;height:3.27778in" alt="A picture containing text, screenshot, diagram, plot Description automatically generated" class="figure-img"></a></p>
<figcaption>A picture containing text, screenshot, diagram, plot Description automatically generated</figcaption>
</figure>
</div>
<p>Figure 6 Comparing systems on a low VRE day. Source: ITK</p>
<p>Finally I show some of the actual numbers that were used in compiling Figure 6. Again note that when the storage asset is charging it loses some of the energy to running the pumps or in the BESS case to other losses.</p>
</section>
<section id="in-table-form-a-subset-of-the-numbers-shows" class="level1">
<h1>In table form a subset of the numbers shows:</h1>
<p><a href="media/media/image7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="media/media/image7.png" style="width:6.26389in;height:6.86389in"></a></p>
<p>Figure 7 half hourly model output 21 Feb 2045 QLD. Source: ITK</p>
</section>
<section id="economics" class="level1">
<h1>Economics</h1>
<p>As discussed the BESS will have a shorter life than pumped hydro and also likely higher maintenance cost but can be built far more quickly. The BESS can also provide additional revenues by managing the grid frequency. The BESS can be located all along the existing grid likely providing additional grid capacity but specifically it should avoid most of if not all the transmission that Borumba requires.</p>
<p>In my last note I took a generous view of the $14 bn announced Borumba cost and assumed it included the associated transmission. Some more reading makes me now inclined to believe that Borumba is currently costed at $14 bn plus transmission.</p>
<p>If that’s the case the BESS gets within striking difference of Borumba</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="media/media/image8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="A picture containing text, screenshot, font, number Description automatically generated"><img src="media/media/image8.png" style="width:4.5in;height:1.80556in" alt="A picture containing text, screenshot, font, number Description automatically generated" class="figure-img"></a></p>
<figcaption>A picture containing text, screenshot, font, number Description automatically generated</figcaption>
</figure>
</div>
<p>Figure 8 2 48 GWh storage system costs. Source: QLD Gov, ITK</p>
<p>When you have chosen Borumba you will need at least another 2000 MW of firming and probably another 4000 to catch up with what the 6 GW/8 hour BESS can do. So all of a sudden I’m asking why so keen on Borumba? Its true my BESS numbers are a bit of a stretch, lots of assumed cost down, no transmission costs. Yet I still think if it was me, I’d look again.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/itk\.quarto\.pub\/itk_articles");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024 ITK admin@itkservices.com.au</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>